<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Propamit</title>
    <link rel="stylesheet" href="assets/css/admin-dashboard.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="admin-wrapper">
      <!-- Admin Sidebar -->
      <aside class="admin-sidebar">
        <div class="sidebar-header">
          <img src="assets/img/logofornow.svg" alt="Propamit" class="logo" />
          <h3>Admin Panel</h3>
        </div>

        <nav class="admin-nav">
          <a href="#dashboard" class="nav-item active" data-section="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
          <a href="#users" class="nav-item" data-section="users">
            <i class="fas fa-users"></i>
            <span>Users</span>
          </a>
          <a href="#applications" class="nav-item" data-section="applications">
            <i class="fas fa-file-alt"></i>
            <span>Applications</span>
          </a>
          <a href="#messages" class="nav-item" data-section="messages">
            <i class="fas fa-envelope"></i>
            <span>Messages</span>
            <span class="badge" id="messagesBadge">0</span>
          </a>
          <a href="#documents" class="nav-item" data-section="documents">
            <i class="fas fa-folder"></i>
            <span>Documents</span>
          </a>
          <a href="#settings" class="nav-item" data-section="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
          </a>
        </nav>

        <div class="sidebar-footer">
          <button class="admin-logout-btn" id="adminLogout">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="admin-main">
        <header class="admin-header">
          <div class="header-left">
            <button class="sidebar-toggle" id="sidebarToggle">
              <i class="fas fa-bars"></i>
            </button>
            <h1 id="pageTitle">Dashboard</h1>
          </div>

          <div class="header-right">
            <div class="admin-user">
              <i class="fas fa-user-shield"></i>
              <span id="adminName">Administrator</span>
            </div>
          </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="admin-section active">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon blue">
                <i class="fas fa-users"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="totalUsers">0</div>
                <div class="stat-label">Total Users</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon green">
                <i class="fas fa-file-alt"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="totalApplications">0</div>
                <div class="stat-label">Applications</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon orange">
                <i class="fas fa-clock"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="pendingApplications">0</div>
                <div class="stat-label">Pending</div>
              </div>
            </div>

            <div class="stat-card">
              <div class="stat-icon purple">
                <i class="fas fa-envelope"></i>
              </div>
              <div class="stat-content">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">Messages</div>
              </div>
            </div>
          </div>

          <div class="dashboard-content">
            <div class="recent-activity">
              <h3>Recent Activity</h3>
              <div id="recentActivity" class="activity-list">
                <!-- Activity items will be loaded here -->
              </div>
            </div>
          </div>
        </section>

        <!-- Users Section -->
        <section id="users-section" class="admin-section">
          <div class="section-header">
            <h2>User Management</h2>
            <div class="section-actions">
              <input
                type="text"
                id="userSearch"
                placeholder="Search users..."
                class="search-input"
              />
              <button class="btn btn-primary" id="refreshUsers">
                <i class="fas fa-sync"></i>
                Refresh
              </button>
            </div>
          </div>

          <div class="users-table-container">
            <table class="admin-table" id="usersTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Registered</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Users will be loaded here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Applications Section -->
        <section id="applications-section" class="admin-section">
          <div class="section-header">
            <h2>Applications Management</h2>
            <div class="section-actions">
              <select id="statusFilter" class="filter-select">
                <option value="all">All Status</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
              <button class="btn btn-primary" id="refreshApplications">
                <i class="fas fa-sync"></i>
                Refresh
              </button>
            </div>
          </div>

          <div class="applications-table-container">
            <table class="admin-table" id="applicationsTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th>Submitted</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="applicationsTableBody">
                <!-- Applications will be loaded here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Messages Section -->
        <section id="messages-section" class="admin-section">
          <div class="section-header">
            <h2>Messages & Support</h2>
            <div class="section-actions">
              <button class="btn btn-primary" id="refreshMessages">
                <i class="fas fa-sync"></i>
                Refresh
              </button>
            </div>
          </div>

          <div class="messages-container" id="messagesContainer">
            <!-- Messages will be loaded here -->
          </div>
        </section>
      </main>

      <!-- Mobile Overlay for Sidebar -->
      <div class="mobile-overlay" id="mobileOverlay"></div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Loading...</span>
      </div>
    </div>

    <script>
      // Check admin authentication first
      function checkAdminAuth() {
        const isAdmin = localStorage.getItem("isAdmin");
        const adminToken = localStorage.getItem("adminToken");
        const adminEmail = localStorage.getItem("adminEmail");

        if (!isAdmin || !adminToken) {
          window.location.href = "admin-login.html";
          return false;
        }

        // Update admin name in header
        const adminNameEl = document.getElementById("adminName");
        if (adminNameEl && adminEmail) {
          adminNameEl.textContent = adminEmail;
        }

        return true;
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded, initializing admin dashboard...");

        // Check authentication
        if (!checkAdminAuth()) {
          return; // Will redirect to login
        }

        // Initialize all functionality
        initializeSidebar();
        initializeNavigation();
        initializeLogout();
        loadDashboardData();

        console.log("Admin dashboard initialized successfully");
      });

      // Sidebar functionality (Mobile)
      function initializeSidebar() {
        const sidebarToggle = document.getElementById("sidebarToggle");
        const sidebar = document.querySelector(".admin-sidebar");
        const overlay = document.getElementById("mobileOverlay");

        console.log("Initializing sidebar...", {
          sidebarToggle,
          sidebar,
          overlay,
        });

        if (sidebarToggle && sidebar) {
          sidebarToggle.addEventListener("click", function () {
            console.log("Sidebar toggle clicked");
            sidebar.classList.add("mobile-active");
            if (overlay) overlay.classList.add("active");
          });
        }

        if (overlay && sidebar) {
          overlay.addEventListener("click", function () {
            console.log("Overlay clicked");
            sidebar.classList.remove("mobile-active");
            overlay.classList.remove("active");
          });
        }

        // Handle window resize
        window.addEventListener("resize", function () {
          if (window.innerWidth > 768 && sidebar) {
            sidebar.classList.remove("mobile-active");
            if (overlay) overlay.classList.remove("active");
          }
        });
      }

      // Navigation functionality
      function initializeNavigation() {
        const navItems = document.querySelectorAll(".nav-item");
        const sections = document.querySelectorAll(".admin-section");
        const pageTitle = document.getElementById("pageTitle");

        console.log("Initializing navigation...", {
          navItems: navItems.length,
          sections: sections.length,
        });

        navItems.forEach((item) => {
          item.addEventListener("click", function (e) {
            e.preventDefault();

            const targetSection = this.getAttribute("data-section");
            console.log("Nav item clicked:", targetSection);

            // Remove active class from all nav items and sections
            navItems.forEach((nav) => nav.classList.remove("active"));
            sections.forEach((section) => section.classList.remove("active"));

            // Add active class to clicked nav item
            this.classList.add("active");

            // Show target section
            const targetSectionEl = document.getElementById(
              targetSection + "-section"
            );
            if (targetSectionEl) {
              targetSectionEl.classList.add("active");
            }

            // Update page title
            if (pageTitle) {
              pageTitle.textContent = this.querySelector("span").textContent;
            }

            // Load section-specific data
            loadSectionData(targetSection);
          });
        });
      }

      // Load section-specific data
      function loadSectionData(section) {
        console.log("Loading data for section:", section);

        switch (section) {
          case "users":
            loadUsers();
            break;
          case "applications":
            loadApplications();
            break;
          case "messages":
            loadMessages();
            break;
          case "dashboard":
            loadDashboardData();
            break;
        }
      }

      // Logout functionality
      function initializeLogout() {
        const logoutBtn = document.getElementById("adminLogout");

        console.log("Initializing logout...", { logoutBtn });

        if (logoutBtn) {
          logoutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            console.log("Logout clicked");
            logout();
          });
        }
      }

      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("isAdmin");
          localStorage.removeItem("adminToken");
          localStorage.removeItem("adminEmail");
          window.location.href = "admin-login.html";
        }
      }

      // Load dashboard data
      function loadDashboardData() {
        console.log("Loading dashboard data...");
        loadStats();
        loadRecentActivity();
      }

      function loadStats() {
        const stats = {
          totalUsers: 1234,
          totalApplications: 567,
          pendingApplications: 89,
          totalMessages: 45,
        };

        Object.keys(stats).forEach((key) => {
          const element = document.getElementById(key);
          if (element) {
            element.textContent = stats[key].toLocaleString();
          }
        });
      }

      function loadUsers() {
        const usersTableBody = document.getElementById("usersTableBody");
        if (!usersTableBody) return;

        const sampleUsers = [
          {
            id: 1,
            name: "John Doe",
            email: "john@example.com",
            phone: "+234 801 234 5678",
            status: "Active",
            joined: "2024-01-15",
          },
          {
            id: 2,
            name: "Jane Smith",
            email: "jane@example.com",
            phone: "+234 802 345 6789",
            status: "Active",
            joined: "2024-02-20",
          },
          {
            id: 3,
            name: "Mike Johnson",
            email: "mike@example.com",
            phone: "+234 803 456 7890",
            status: "Inactive",
            joined: "2024-03-10",
          },
          {
            id: 4,
            name: "Sarah Wilson",
            email: "sarah@example.com",
            phone: "+234 804 567 8901",
            status: "Active",
            joined: "2024-04-05",
          },
        ];

        usersTableBody.innerHTML = sampleUsers
          .map(
            (user) => `
        <tr>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.phone}</td>
            <td>${user.joined}</td>
            <td><span class="status-badge ${user.status.toLowerCase()}">${
              user.status
            }</span></td>
            <td>
                <button class="btn btn-primary" onclick="viewUser(${
                  user.id
                })">View</button>
                <button class="btn btn-danger" onclick="deleteUser(${
                  user.id
                })">Delete</button>
            </td>
        </tr>
    `
          )
          .join("");
      }

      function loadApplications() {
        const applicationsTableBody = document.getElementById(
          "applicationsTableBody"
        );
        if (!applicationsTableBody) return;

        const sampleApplications = [
          {
            id: "APP001",
            user: "John Doe",
            type: "Vehicle Registration",
            status: "Pending",
            date: "2024-06-21",
          },
          {
            id: "APP002",
            user: "Jane Smith",
            type: "Driver License",
            status: "Approved",
            date: "2024-06-20",
          },
          {
            id: "APP003",
            user: "Mike Johnson",
            type: "License Renewal",
            status: "Rejected",
            date: "2024-06-19",
          },
          {
            id: "APP004",
            user: "Sarah Wilson",
            type: "Vehicle Registration",
            status: "Pending",
            date: "2024-06-18",
          },
        ];

        applicationsTableBody.innerHTML = sampleApplications
          .map(
            (app) => `
        <tr>
            <td>${app.id}</td>
            <td>${app.user}</td>
            <td>${app.type}</td>
            <td><span class="status-badge ${app.status.toLowerCase()}">${
              app.status
            }</span></td>
            <td>${app.date}</td>
            <td>
                <button class="btn btn-success" onclick="approveApplication('${
                  app.id
                }')">Approve</button>
                <button class="btn btn-danger" onclick="rejectApplication('${
                  app.id
                }')">Reject</button>
            </td>
        </tr>
    `
          )
          .join("");
      }

      function loadMessages() {
        const messagesContainer = document.getElementById("messagesContainer");
        if (!messagesContainer) return;

        const sampleMessages = [
          {
            id: 1,
            from: "John Doe",
            subject: "Application Status Inquiry",
            date: "2024-06-21",
            status: "Unread",
          },
          {
            id: 2,
            from: "Jane Smith",
            subject: "Document Upload Issue",
            date: "2024-06-20",
            status: "Read",
          },
          {
            id: 3,
            from: "Mike Johnson",
            subject: "Payment Confirmation",
            date: "2024-06-19",
            status: "Read",
          },
          {
            id: 4,
            from: "Sarah Wilson",
            subject: "General Inquiry",
            date: "2024-06-18",
            status: "Unread",
          },
        ];

        messagesContainer.innerHTML = `
        <div class="messages-list">
            ${sampleMessages
              .map(
                (msg) => `
                <div class="message-item ${msg.status.toLowerCase()}">
                    <div class="message-header">
                        <strong>${msg.from}</strong>
                        <span class="message-date">${msg.date}</span>
                    </div>
                    <div class="message-subject">${msg.subject}</div>
                    <div class="message-actions">
                        <button class="btn btn-primary" onclick="viewMessage(${
                          msg.id
                        })">View</button>
                        <button class="btn btn-success" onclick="replyMessage(${
                          msg.id
                        })">Reply</button>
                    </div>
                </div>
            `
              )
              .join("")}
        </div>
    `;
      }

      function loadRecentActivity() {
        const activityList = document.getElementById("recentActivity");
        if (!activityList) return;

        const activities = [
          {
            type: "user",
            text: "New user registered: John Doe",
            time: "2 minutes ago",
          },
          {
            type: "application",
            text: "Application APP001 submitted",
            time: "5 minutes ago",
          },
          {
            type: "message",
            text: "New message from Jane Smith",
            time: "10 minutes ago",
          },
          {
            type: "approval",
            text: "Application APP002 approved",
            time: "15 minutes ago",
          },
        ];

        activityList.innerHTML = activities
          .map(
            (activity) => `
        <div class="activity-item">
            <div class="activity-text">${activity.text}</div>
            <div class="activity-time">${activity.time}</div>
        </div>
    `
          )
          .join("");
      }

      // Action functions
      function viewUser(userId) {
        alert(`View user details for ID: ${userId}`);
      }

      function deleteUser(userId) {
        if (confirm("Are you sure you want to delete this user?")) {
          alert(`User ${userId} deleted successfully!`);
          loadUsers();
        }
      }

      function approveApplication(appId) {
        if (confirm(`Approve application ${appId}?`)) {
          alert(`Application ${appId} approved successfully!`);
          loadApplications();
        }
      }

      function rejectApplication(appId) {
        if (confirm(`Reject application ${appId}?`)) {
          alert(`Application ${appId} rejected!`);
          loadApplications();
        }
      }

      function viewMessage(msgId) {
        alert(`View message ID: ${msgId}`);
      }

      function replyMessage(msgId) {
        alert(`Reply to message ID: ${msgId}`);
      }

      // Make functions globally available
      window.logout = logout;
      window.viewUser = viewUser;
      window.deleteUser = deleteUser;
      window.approveApplication = approveApplication;
      window.rejectApplication = rejectApplication;
      window.viewMessage = viewMessage;
      window.replyMessage = replyMessage;
    </script>
  </body>
</html>
